
<!DOCTYPE html> 

<html> 
	<title> Otaku Hub Anime Recommender Results </title> 
	<meta name ="viewpoint" content = "width=device-width, initial-scale = 1.0"> 
	<link href  = "css/bootstrap.min.css" rel = "stylesheet"> 
	<link href  = "css/styles.css" rel = "stylesheet"> 
	<head></head> 
	
	<body>
	<div class="row" style="padding-top: 20px" >
            <div class="col-lg-3" ></div>
            <div class="col-lg-3" style = "float:right;">
			<form id = "UserName" method="GET" action="Results.html"> 
                <div class="input-group pull-right">
                    <input type="text" class="form-control text-center" placeholder = "MyAnimelist Username" input name = "AL" > 
                    <span class="input-group-btn">
                        <!-- Remove onClick not work as planned -->
						<button class="btn btn-default" button type="submit" value = "Submit" > GO!</button>
					</span>
                </div><!-- /input-group -->
			 </form> 
            </div><!-- /.col-lg-4 -->
            <div class="col-lg-3"></div>
        </div><!-- /.row -->
	
	<div class="container">
		<div class="Info" style="padding-top: 50px">
				<center> <font size="6">Your Anime Recommendations </font> </center>
		</div>
			
		<div class = "AnimeTable" style="padding-top: 30px"> 
		  <table id = "Anime" table class="table table-striped table-hover" style = "display:true;">
	    	  <tbody>
	    	  </tbody>
	      </table> 
		</div>
  
	</div>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="js/functions/userdata.js"></script> 
	<script src="js/functions/UI.js"></script> 
	<script>
		

        var queryDict = {}
        location.search.substr(1).split("&").forEach(function(item) {
                queryDict[item.split("=")[0]] = item.split("=")[1]
                
            });
            
		var debug=0; //variable used to turn off various elements that are printed for testing purpouses
		    //I need to add catching for errors
				    var username= queryDict["AL"]; //retrieve data in field
		    if (debug) console.log(username)
		    //call get userlist function which does assyncronous call to yql api to get users list
		    //then pass in a second function for it to do when its done geting the information sucessfully
			getUserList(username, function(data){
				if (debug) document.write(JSON.stringify(data));
				if (debug) document.write("<br>")
				var animeList="";
				var animeArr = [] 
				if($.isArray(data.anime)) //if the user has more than one anime in his list
				{
					$.each(data.anime,  function()
					{
	   					animeList+="title=~"+encodeURI(this.series_title)+"&";
	                	animeArr.push(this.series_title);
	              	});
	             }
				else //if user has one anime in his list 
				{
					animeList+="title=~"+encodeURI(data.anime.series_title)+"&";
					animeArr.push(data.anime.series_title)
				}
				
				function numRows(animelist)
				{
					var numRows = 0;
					var maxRows = 0;					
					for(i = 0; i < animelist.length; i++)
					{
						maxRows += 1;
						if(maxRows == 3)
						{
							maxRows = 0;
							numRows += 1;
						}
					}
					
					if(maxRows == 1) 
					{
						numRows = 1; 
					}
					
					return numRows; 
				}
				
				function setRowColor(numRows)
				{
					var AnimeTable = document.getElementById("Anime");
					var rows = AnimeTable.getElementsByTagName("tr");
					for(i = 0; i < numRows; i++)
					{
						if(i%2 == 0)
						{
							rows[i].style.backgroundColor = "#909090";
						}
						
						else 
						{
							rows[i].style.backgroundColor = "#90EE90";
						}
					}
				}
				
				CreateTable(animeArr); 
				var Rows = numRows(animeArr);
				document.getElementById("Anime").style.textAlign="center";
				document.getElementById("Anime").style.fontWeight = "bold";
				setRowColor(Rows);
				
				//this removes extra "&" at the end
              	animeList=animeList.substr(0,animeList.length-1);
              	if (debug) console.log(animeList);

              	if (debug) document.write("<br> This is AnimeData <br>")
				getAnimeData(animeList,function(data){
					if(data.anime != null)
						$.each(data.anime, function(){
							if (this.precision==="TV" && this.type==="TV")
		                		if (debug) document.write(this.name+"<br>");

						})//close of each
				})//close of getanimedata aunonomous function
			}) //close autonmous getUserList function 

		</script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	</body> 
	
</html> 