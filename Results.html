
<!DOCTYPE html> 

<html> 
	<title> Otaku Hub Anime Recommender </title> 
	<meta name ="viewpoint" content = "width=device-width, initial-scale = 1.0"> 
	<link href  = "css/bootstrap.min.css" rel = "stylesheet"> 
	<link href  = "css/styles.css" rel = "stylesheet"> 
	<head></head> 
	
	<body>
	  <table id = "Anime" class="table table-striped table-hover " style = "display:true;">
    	  <tbody>
    	  </tbody>
      </table> 
		
		<h1></h1>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script src="js/functions/userdata.js"></script> 
		<script src="js/functions/UI.js"></script> 
		<script src="js/functions/xml2json.js"></script> 
		<script>
		
		<!-- this is the only way I that is working for me --> 

        var queryDict = {}
        location.search.substr(1).split("&").forEach(function(item) {
                queryDict[item.split("=")[0]] = item.split("=")[1]
                
            });
            
		var debug=1; //variable used to turn off various elements that are printed for testing purpouses
		    //I need to add catching for errors
				    var username= queryDict["AL"]; //retrieve data in field
		    if (debug) console.log(username)
		    //call get userlist function which does assyncronous call to yql api to get users list
		    //then pass in a second function for it to do when its done geting the information sucessfully
			getUserList(username, function(data){
				if (debug) console.log(JSON.stringify(data));
				var animeList="";
				var animeArr = []; 
				var animeRating = [];
				if($.isArray(data.anime)) //if the user has more than one anime in his list
				{
					var counter=0;
					//need to account for 50 animes create a new request
					$.each(data.anime,  function()
					{
	   					animeList+="title=~"+encodeURI(this.series_title)+"&";
	                	animeArr.push(this.series_title);
	                	animeRating.push(this.my_score);
	                	counter++;
	              	});
	             }
				else //if user has one anime in his list 
				{
					animeList+="title=~"+encodeURI(data.anime.series_title)+"&";
					animeArr.push(data.anime.series_title)
				}
				if(debug) console.log("number of animes is:"+ animeArr.length);
				if(!debug) CreateTable(animeArr);
				
				
				//this removes extra "&" at the end
              	animeList=animeList.substr(0,animeList.length-1);
              	if (debug) console.log(animeList);
              	if (debug) console.log(animeArr);
              	var currentData=[];
              	if (debug) console.log("<br> This is AnimeData <br>");
              	//need to create a function that calls the api as many times as needed and creates
              	//a object that has all the data needed and then calls the callback function
				getAnimeData(animeList,function(data){
					if(data.anime != null)
					{
						if(debug) console.log(data.anime);
						$.each(data.anime, function(){
							if (this["@attributes"].precision==="TV" && this["@attributes"].type==="TV")
							{
								if (debug) console.log("'"+this["@attributes"].name+"'");
								if ($.inArray(this["@attributes"].name, animeArr) >=-1)
								{
									if (debug) console.log("'"+this["@attributes"].name+"'");
									this.rating =animeRating[$.inArray(this["@attributes"].name, animeArr)];
									currentData.push(this);
								} 
							}
		                		

						})//close of each
						if(debug) console.log(data.warning["#text"]);
					}
					if(debug) CreateTable_v(currentData);
				});//close of getanimedata aunonomous function
			}); //close autonmous getUserList function 

		</script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	</body> 
	
</html> 